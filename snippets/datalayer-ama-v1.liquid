<script> 
if(!window.jQuery){
	var jqueryScript = document.createElement('script');
	jqueryScript.setAttribute('src','https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js');
	document.head.appendChild(jqueryScript);
}
  /* Log State */
  
      {% if customer %}
    	var isLoggedIn = true;
      {% else %}
    	var isLoggedIn = false;
      {% endif %}

      /** DATALAYER: Product Page
    	* Fire on all Product View pages. */
        {% if template contains 'product' %} 
          var ecommerce = {
            	 
                	'item_id'    	: {{product.id | json}},  
                	'item_variant'	: {{product.selected_or_first_available_variant.id | json}},        	 
                	'item_name'  	: {{product.title | json}},
                	'price'       	: {{product.price | money_without_currency | replace: ',', '.' | json}},
                	'item_brand'  	: {{product.vendor | json}},
                    'currency'  	: {{shop.currency | json}},
                	'productURL'  	: '{{product.url}}'
            	 
        	};          	 
        	  dataLayer.push({
            	'pageType' : 'Product',
            	'event'	: 'view_item_ama',
       		    ecommerce
       		 }); 

          $(".add-to-cart").click(function(){
            dataLayer.push({
            	'event'	: 'add_to_cart_ama',
       		    ecommerce
       		 }); 
          });
        {% endif %}

  /* BEGIN CHECKOUT LINK TRIGGER */
   $(".cart__checkout").click(function(){
      dataLayer.push({
                'event'	: 'begin_checkout_ama',
                  'items' : '[{% for item in cart.items %}{{ item.id }}{% unless forloop.last %},{% endunless %}{% endfor %}]',
                  'original_total_price' : '{{ cart.item_count }}',
                  'total_price' : '{{ cart.total_price }}',
                  'total_discount' : '{{ cart.total_discount }}',
                  'item_count' : '{{ cart.item_count }}',
                  'currency' : {{shop.currency | json}},
                  'items_subtotal_price' : '{{ cart.items_subtotal_price }}',
                  'init_checkout_url' : '{{ canonical_url }}'
             });
     });

  
</script>